<!DOCTYPE html>
<html>
    <head>
        <title>ZevChess!</title>
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='chessground.base.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='chessground.brown.css') }}">
        <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='chessground.cburnett.css') }}">
        <style>
            #chessground {
                width: 360px;
                height: 360px;
            }
            cg-board {
                background-color: #bfcfdd;
            }
            .center {
                display: flex;
                justify-content: center;
                align-items: center;
                margin-bottom: 2em !important;
            }

            textarea {
                margin-top: 5vh;
                width: 40vw;
                height: 20vh;
            }
        </style>

        <script type="module">
            import { Chessground } from "{{ url_for('static', filename='chessground.min.js') }}";
            const config = {};
            const ground = Chessground(document.getElementById('chessground'), config);
            // TODO: remove this, it's for development
            window.ground = ground
        </script>
    </head>
    <body>
        <div id="chessground"></div>
        <div id="watcher-count"></div>
        <textarea readonly id="ws"></textarea>
    </body>
    <script>
        const numberOfWatchers = 0;
        const players = {
            black: null,
            white: null,
        }
        const gameState = {}
        const uid = '{{ uid }}';
        const wsMessageElement = document.getElementById('ws');

        window.addEventListener("DOMContentLoaded", () => {
            const board = document.getElementById("chessground");
            const ws = new WebSocket("ws://localhost:8001/");
            joinGame(ws);
            receiveMoves(board, ws);
            sendMoves(board, ws);
        })

        function joinGame(ws) {
            ws.addEventListener("open", function() {
                const message = JSON.stringify({type: "join", uid})
                ws.send(message);
                wsMessageElement.value = wsMessageElement.value + `\nsent: ${message}\n`
            })
        }

        function receiveMoves(board, ws) {
            ws.addEventListener("message", function(message) {
                console.log(message.data)
                const event = JSON.parse(message.data)
                wsMessageElement.value = wsMessageElement.value + `\nreceived: ${message.data}\n`
                // TODO: in a case statement,
                //   if it's a move from a player other than this one, use `ground.move("a4", "a5")`
            }) 
        }

        function sendMoves(board, ws) {
            return null;
        }
    </script>
</html>
